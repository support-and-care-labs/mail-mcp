//
// Copyright 2025 The Apache Software Foundation
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//

= Roadmap and Implementation Status
:toc:
:toclevels: 2

== Overview

This document tracks the current implementation status and planned features for mail-mcp.

== Current Status

üöß *Early Development Phase*

The project currently provides data retrieval infrastructure and is building toward a full MCP server implementation.

== Completed Features

=== Infrastructure

‚úÖ Python project structure with Poetry
‚úÖ Docker Compose configuration with Elasticsearch
‚úÖ Configuration management with environment variables
‚úÖ Structured logging with structlog

=== Data Retrieval

‚úÖ CLI tool for downloading mbox files (`retrieve-mbox`)
‚úÖ Support for any Apache mailing list
‚úÖ Proper error handling and atomic file writes

=== Storage Layer

‚úÖ Elasticsearch client wrapper (async)
‚úÖ Index schema definition for email messages
‚úÖ Connection management and health checks
‚úÖ Single and bulk document indexing
‚úÖ Search query execution

=== Parsing

‚úÖ mbox file parser
‚úÖ Email message parser
‚úÖ Header extraction (From, To, Subject, Date, Message-ID, References)
‚úÖ Body extraction from multipart MIME
‚úÖ Encoding handling (UTF-8, ISO-8859-1, etc.)
‚úÖ List information extraction

== Recently Completed

=== Metadata Extraction ‚úÖ

‚úÖ JIRA references extraction (MNG-1234, MRESOLVER-567, etc.)
‚úÖ GitHub references (PR numbers, commit SHAs)
‚úÖ Version number detection
‚úÖ Decision indicators (votes, keywords like "decided", "consensus")
‚úÖ Quote detection and filtering
‚úÖ Effective body extraction (quotes removed)

=== Indexing Pipeline ‚úÖ

‚úÖ Bulk indexing with progress tracking
‚úÖ CLI tool for indexing single files or directories
‚úÖ Configurable batch sizes
‚úÖ Error recovery and statistics

=== MCP Server Implementation ‚úÖ

‚úÖ FastMCP-based server with stdio transport
‚úÖ Four MCP tools implemented:
  * `search_emails` - Full-text search with filters
  * `get_message` - Retrieve message by ID
  * `get_thread` - Reconstruct email threads
  * `find_references` - Find JIRA/GitHub references
‚úÖ Claude Desktop integration ready
‚úÖ Comprehensive documentation

== Planned Features

=== Phase 1: Enhanced Threading

Improved thread reconstruction::
* Build hierarchical thread trees from References/In-Reply-To headers
* Handle missing messages gracefully
* Fallback to subject-based threading
* Thread visualization and navigation

=== Phase 2: Additional MCP Tools

Enhanced search capabilities::
* `get_decisions` - Dedicated tool for finding decision-related discussions
* `search_by_contributor` - Find emails by specific contributors
* `get_statistics` - Get mailing list statistics and trends

Resource definitions::
* Message resources for direct access
* Thread resources for conversation contexts
* List resources for mailing list metadata

=== Phase 3: Enhanced Search

Advanced features::
* Temporal queries (date ranges, trends over time)
* Aggregations (top contributors, active periods)
* Similarity search (find related discussions)
* Cross-list search (search multiple mailing lists)

Quote handling::
* Separate storage of quoted vs. new content
* Quote percentage calculation
* Focus search on original content only

=== Phase 4: Additional Features

Performance optimization::
* Caching layer for frequently accessed data
* Pagination for large result sets
* Query optimization

Data enrichment::
* Link emails to Jira issues (external API)
* Link emails to GitHub PRs (external API)
* Contributor identity resolution

Monitoring::
* Metrics export (Prometheus)
* Health check endpoints
* Performance dashboards

== Implementation Phases (from ADR-0002)

=== Phase 1: Core Infrastructure ‚úÖ

* ‚úÖ Set up Python project structure with poetry
* ‚úÖ Implement Elasticsearch client wrapper
* ‚úÖ Define index schema and mappings
* ‚úÖ Basic mbox/email parsing

=== Phase 2: Data Ingestion ‚úÖ

* ‚úÖ Implement full mbox parser
* ‚úÖ Metadata extraction (decision indicators, references)
* ‚úÖ Quote detection and filtering
* ‚è≥ Advanced thread reconstruction logic
* ‚úÖ Bulk indexing to Elasticsearch

=== Phase 3: MCP Server ‚úÖ

* ‚úÖ Implement MCP server with official SDK (FastMCP)
* ‚úÖ Define and implement MCP tools
* ‚úÖ Tool parameter validation
* ‚úÖ Error handling and logging

=== Phase 4: Testing & Quality (Planned)

* ‚è≥ Unit tests for all parsers and extractors
* ‚è≥ Integration tests with Elasticsearch
* ‚úÖ Docker Compose setup for local development
* ‚è≥ CI/CD pipeline configuration

=== Phase 5: Documentation & Polish (Ongoing)

* ‚úÖ API documentation (ongoing)
* ‚úÖ Developer guide
* ‚è≥ Deployment guide
* ‚è≥ Performance tuning

== Open Questions

From ADRs and development process:

. **Vector search**: When to implement semantic search capabilities?
. **Multi-list strategy**: How to handle cross-list queries efficiently?
. **Thread fallback**: Subject-based threading when headers are missing?
. **Update strategy**: Pull-based (periodic) vs. push-based (webhooks)?
. **Citation handling**: How aggressive to filter quoted content?
. **Cross-posting**: Deduplicate messages sent to multiple lists?

See xref:adr/[Architecture Decision Records] for detailed discussions.

== Contributing

Want to help implement features?
See xref:development.adoc[Development Guide] for setup and contribution guidelines.

Priority areas for contribution:

* Metadata extraction implementations
* Test coverage
* Documentation improvements
* Performance optimization
* Additional MCP tools

== Related Documentation

* xref:development.adoc[Development Guide]
* xref:adr/0001-storage-and-access-strategy.adoc[ADR-0001: Storage Strategy]
* xref:adr/0002-technology-stack.adoc[ADR-0002: Technology Stack]
* xref:../README.adoc[Project README]
